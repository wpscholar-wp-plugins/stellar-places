"use strict";!function(e,t,a,n){var o=t.stellarPlaces||{},l=_.extend({},Backbone.Events);o.getCoordinates=function(e,t){return new google.maps.LatLng(Number(e),Number(t))},o.models={Place:Backbone.Model.extend({})},o.collections={Places:Backbone.Collection.extend({model:o.models.Place})},o.views={Map:Backbone.View.extend({render:function(){var a=this.$el,n=a.width(),i=e.parseJSON(a.attr("data-stellar-places-map-options"));i.center=o.getCoordinates(a.attr("data-stellar-places-map-lat"),a.attr("data-stellar-places-map-lng")),i.mapTypeId&&(i.mapTypeId=google.maps.MapTypeId[i.mapTypeId]);var s=new google.maps.Map(this.el,i),r=new google.maps.LatLngBounds;a.data("map",s),a.data("mapBounds",r);var c=e.parseJSON(a.attr("data-stellar-places-map-locations"));this.collection=new o.collections.Places(c);var d="true"===a.attr("data-stellar-places-map-auto-zoom"),p="true"===a.attr("data-stellar-places-map-info-windows");return this.collection.each(function(t){var i=o.getCoordinates(t.get("latitude"),t.get("longitude"));r.extend(i);var c={map:s,title:t.get("name"),position:i,icon:t.get("icon")};p||(c.cursor="default");var d=new google.maps.Marker(c);if(t.set("marker",d),p){var g=_.template(e("#stellar-places-info-window-template").html())(t.toJSON());d.infoWindow=new google.maps.InfoWindow({content:g,maxWidth:n-140}),google.maps.event.addListener(d,"click",function(e){l.trigger("closeAllInfoWindows"),d.infoWindow.open(s,d)}),google.maps.event.addListener(s,"resize",function(){n=a.width(),d.infoWindow.close()}),l.on("closeAllInfoWindows",function(){d.infoWindow.close()})}}),a.data("stellarPlacesMapLocations",this.collection.map(function(e){return e.toJSON()})),this.collection.length&&(d&&s.fitBounds(r),s.setCenter(r.getCenter()),google.maps.event.addListener(s,"resize",function(){s.setCenter(r.getCenter())})),google.maps.event.addDomListener(t,"resize",function(){var e=s.getCenter();google.maps.event.trigger(s,"resize"),s.setCenter(e)}),this}})},o.initialize=function(){e.each(e(".stellar-places-map-canvas"),function(){new o.views.Map({el:e(this)}).render()})},e(a).ready(function(){o.initialize()})}(jQuery,window,document);